---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---
###load packages
```{r}
knitr::opts_chunk$set(echo = TRUE)
install.packages("timeDate", repos = "http://cran.us.r-project.org")
library(timeDate)
library(plyr)
library(dplyr)
library(data.table)
library(lattice)
```
## Loading and preprocessing the data
*Read file*
*Add "time" column with converted "interval" column values to time format*
*Add "day" column to display weekday*
*Add "wday" logical column for weekend or not*

```{r,echo=TRUE,results='asis'}
data <- read.csv("activity.csv")
data$day <- weekdays(as.Date(data$date))
data$subset_key <- paste(data$day, data$interval, sep="_")
```

# Assignment Questions
## What is mean total number of steps taken per day?
### Calculate total steps, mean and median steps per day
```{r,echo=TRUE,results='asis'}
steps_day <- group_by(data, date)
steps_sum <- summarize(steps_day, day_sum = sum(steps, na.rm = TRUE))
steps_sum_mean <- mean(steps_sum$day_sum)
steps_sum_median <- median(steps_sum$day_sum)
```

### Histogram of total steps per day
```{r,echo=TRUE,results='asis'}
hist(steps_sum$day_sum, breaks = 10, col = "green", main="Histogram of Total Steps Per Day", xlab = "Total Steps Per Day")
```

### Mean of total steps per day
```{r,echo=TRUE,results='asis'}
steps_sum_mean
```

### Median of total steps per day
```{r,echo=TRUE,results='asis'}
steps_sum_median
```

## What is the average daily activity pattern?
### plot of steps taken by intervals
```{r,echo=TRUE,results='asis'}
steps_interval <- group_by(data, interval)
steps_by_interval <- summarize(steps_interval, interval_mean = mean(steps, na.rm = TRUE))
plot(steps_by_interval$interval, steps_by_interval$interval_mean, main="Average Steps Per 5 Minute Interval", xlab="5 Minute Time Intervals", ylab="Average Steps", col = "red", type = "l")
```

###Maximum average steps by interval
```{r,echo=TRUE,results='asis'}
step_interval_max <- steps_by_interval[which.max(steps_by_interval$interval_mean),]
step_interval_max$interval
```

## Imputing missing values
*Total number of rows with NAs*
```{r,echo=TRUE,results='asis'}
sum(is.na(data$steps))
```

*Create subset Data Frame for NA rows*
```{r,echo=TRUE,results='asis'}
data_NA <- data[is.na(data$steps),]
```

*Create subset Data Frame excluding NA rows*
```{r,echo=TRUE,results='asis'}
data_xNA <- data[!is.na(data$steps),]
```

*Calculate imputed value as average steps per day with intervals*
```{r,echo=TRUE,results='asis'}
step_impute <- group_by(data_xNA, subset_key)
step_impute_mean <- summarize(step_impute, impute_val = mean(steps, na.rm = TRUE))
```

*Substitute imputed value for NAs based on day/interval key*
```{r,echo=TRUE,results='asis'}
new_data <- merge(data_NA[,c("date", "interval" , "day", "subset_key")], step_impute_mean, by= "subset_key")
```

*Combine imputed xNA and NA to create new Data Frame*
```{r,echo=TRUE,results='asis'}
colnames(new_data)[5] <- "steps"
new_data <- new_data[c(5,2,3,4,1)]
new_data <- rbind(new_data, data_xNA)
```

*Histogram of total steps per day*
```{r,echo=TRUE,results='asis'}
new_steps_day <- group_by(new_data, date)
new_steps_sum <- summarize(new_steps_day, new_day_sum = sum(steps))
hist(new_steps_sum$new_day_sum, breaks = 10, col = "blue", main="Histogram of Total Steps Per Day (Imputed)", xlab = "Total Steps Per Day (Imputed)")
```

*The mean and median total steps per day*
_Mean_
```{r,echo=TRUE,results='asis'}
new_steps_sum_mean <- mean(new_steps_sum$new_day_sum)
new_steps_sum_mean
```
_Median_
```{r,echo=TRUE,results='asis'}
new_steps_sum_median <- median(new_steps_sum$new_day_sum)
new_steps_sum_median
```

*Differences from before adn after imputing values mean and median increased*
_Mean steps per day difference_
```{r,echo=TRUE,results='asis'}
new_steps_sum_mean - steps_sum_mean
```
_Median steps per day difference_
```{r,echo=TRUE,results='asis'}
new_steps_sum_median - steps_sum_median
```

## Are there differences in activity patterns between weekdays and weekends?
```{r}

new_data$day <- weekdays(as.Date(new_data$date))
new_data$day[new_data$day %in% c("Saturday", "Sunday")] <- "Weekend"
new_data$day[new_data$day != "Weekend"] <- "Weekday"
new_data$day <- as.factor(new_data$day)

aggre_steps <- aggregate(steps ~ interval + day, data = new_data, mean)
aggre_steps$interval <- as.integer(aggre_steps$interval)

xyplot(steps ~ interval | factor(day), 
       data = aggre_steps, 
       layout=c(1,2), 
       type = "l", 
       xlab = "Time Interval",
       ylab = "Average Steps",
       main = "Average steps by interval and weekday or weekend"
      )
```
